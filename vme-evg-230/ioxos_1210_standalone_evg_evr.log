# iocsh -3.14.12.5 vme-evg230-evr230.cmd 
/opt/epics/bases/base-3.14.12.5/bin/eldk56-e500v2/softIoc -D /opt/epics/bases/base-3.14.12.5/dbd/softIoc.dbd /tmp/iocsh.startup.3564
#date="Mon Dec 19 15:55:53 CET 2016"
#user="root"
#PWD="/home/root/localdisk/javier"
#EPICSVERSION="3.14.12.5"
#EPICS_HOST_ARCH="eldk56-e500v2"
#SHELLBOX=""
#EPICS_CA_ADDR_LIST=""
#EPICS_MODULE_INCLUDE_PATH=".:/usr/lib:/lib"
dlload         /opt/epics/modules/environment/1.4.1/3.14.12.5/lib/eldk56-e500v2/libenvironment.so
dbLoadDatabase /opt/epics/modules/environment/1.4.1/3.14.12.5/dbd/environment.dbd
environment_registerRecordDeviceDriver
< "vme-evg230-evr230.cmd"
#  -*- mode: epics -*-
# This file should be used with EPICS base 3.14.12.5 and mrfioc2 (2.7.13)
#
# With current EEE 1.8.2, the proper command is 
#
# iocsh -3.14.12.5 vme-evg-230/vme-evg230-evr230.cmd
#
require pev,0.1.2
require: pev depends on pevdrv (4.66+).
require: Loading library /opt/epics/modules/pevdrv/4.66.0/3.14.12.5/lib/eldk56-e500v2/libpevdrv.so.
require: pev depends on regdev (0.1+).
require: Loading library /opt/epics/modules/regdev/0.1.0/3.14.12.5/lib/eldk56-e500v2/libregdev.so.
require: Adding /opt/epics/modules/regdev/0.1.0/db.
require: Loading /opt/epics/modules/regdev/0.1.0/3.14.12.5/dbd/regdev.dbd.
require: Calling regdev_registerRecordDeviceDriver function.
require: Loading library /opt/epics/modules/pev/0.1.2/3.14.12.5/lib/eldk56-e500v2/libpev.so.
require: Adding /opt/epics/modules/pev/0.1.2/db.
require: Loading /opt/epics/modules/pev/0.1.2/3.14.12.5/dbd/pev.dbd.
require: Calling pev_registerRecordDeviceDriver function.
require mrfioc2,2.7.13
require: mrfioc2 depends on devlib2 (2.7+).
require: Loading library /opt/epics/modules/devlib2/2.7.0/3.14.12.5/lib/eldk56-e500v2/libdevlib2.so.
require: Loading /opt/epics/modules/devlib2/2.7.0/3.14.12.5/dbd/devlib2.dbd.
require: Calling devlib2_registerRecordDeviceDriver function.
require: Loading library /opt/epics/modules/mrfioc2/2.7.13/3.14.12.5/lib/eldk56-e500v2/libmrfioc2.so.
require: Adding /opt/epics/modules/mrfioc2/2.7.13/db.
require: Adding /opt/epics/modules/mrfioc2/2.7.13/startup.
require: Loading /opt/epics/modules/mrfioc2/2.7.13/3.14.12.5/dbd/mrfioc2.dbd.
require: Calling mrfioc2_registerRecordDeviceDriver function.
epicsEnvSet("IOC" "SD-TS-IOC")
epicsEnvSet("SYS"           "TS")
epicsEnvSet("EVG"         "EVG0")
epicsEnvSet("EVG_VMESLOT"     "6")
epicsEnvSet("EVR"          "EVR0")
epicsEnvSet("EVR_VMESLOT"     "3")
epicsEnvSet("EVR_VMEBASE"     "0x3000000")
epicsEnvSet("EVR_VMELEVEL"    "4")
epicsEnvSet("EVR_VMEVECTOR"   "0x28")
mrmEvgSetupVME(EVG0, 6, 0x100000, 1, 0x01)    
##### Setting up MRF EVG in VME Slot 6 #####
Found Vendor: 00000eb2
Board: 454700e6
Revision: 00000000
Warning: EVG not in power on state! (001000f4)
FPGA version: 22000005
Firmware version: 00000005
Sub-units:
 FrontInp: 2, FrontOut: 6
 UnivInp: 4, UnivOut: 4
 RearInp: 16
 RearOut: 0
 Mxc: 8, Event triggers: 8, DBus bits: 8
Found EVG0:SFP0 SFP transceiver
Flash access: Timeout reached while waiting for transmitter to be empty!
IRQ Level: 241
IRQ Vector: 1
csrCpuAddr : 0xb6e00000
regCpuAddr : 0xb6d00000
reCpuAddr2 : (nil)
# Fake timestamp source for testing without real hardware timestamp source (e.g., GPS recevier)
mrmEvgSoftTime(EVG0)
Starting EVG Software based time provider...
pthread_attr_setstacksize error Invalid argument
mrmEvgSoftTimestamp: Could not retrive timestamp...
mrmEvrSetupVME(EVR0, 3, 0x3000000, 4, 0x28)
Setting up EVR in VME Slot 3
Found vendor: 00000eb2 board: 455246e6 rev.: 00000000
FPGA version 0x12000006
Firmware version: 00000006
Found EVR0:SFP0 SFP transceiver
Flash access: Timeout reached while waiting for transmitter to be empty!
VME 64: Out FP:7 FPUNIV:4 RB:16 IFP:2 GPIO:2
Using IRQ 44:40
# ESS ICS Definition
epicsEnvSet("HWEVT"    "14")
epicsEnvSet("EVTFREQ"  "14")
epicsEnvSet("EPICSEVT" "14")
# Fake Timestamp
epicsEnvSet("EVRTSE"   "-2")
# Don't change HBEVT 
epicsEnvSet("HBEVT"   "122")
# One can change, but don't change it.
epicsEnvSet("HBFREQ"    "1")
# --------------------------------------------------------
# Set Heart Beat Event (Evtcode, Fre, TrigSrc7) (122, 1, 1)
# Set 14 Hz      Event (Evtcode, Fre, TrigSrc0) (14, 14, 1)
# 
dbLoadRecords("evg-vme-230.db", "DEVICE=EVG0, SYS=TS, TrigEvt7-EvtCode-SP=122, Mxc2-Frequency-SP=1, Mxc2-TrigSrc7-SP=1, TrigEvt0-EvtCode-SP=14, Mxc0-Frequency-SP=14, Mxc0-TrigSrc0-SP=1, SoftEvt-Enable-Sel=1")
dbLoadRecords("evr-vme-230.db", "DEVICE=EVR0, SYS=TS")
#Generate trigger signals
# Time Stamping on EVR
dbLoadRecords("evr-softEvent.template", "DEVICE=EVR0, SYS=TS, CODE=14, EVT=14")
# Trigger Output on EVR
dbLoadRecords("evr-pulserMap.template", "DEVICE=EVR0, SYS=TS, PID=0, F=Trig, ID=0, EVT=14")
iocInit
Starting iocInit
############################################################################
## EPICS R3.14.12.5-2015-08 $Date: Tue 2015-03-24 09:57:35 -0500$
## EPICS Base built Oct  9 2015
############################################################################
Set EVR clock 124916000.000000
TS-EVR0:FrontOut0-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut1-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut2-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut3-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut4-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut5-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontOut6-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontUnivOut0-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontUnivOut1-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontUnivOut2-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:FrontUnivOut3-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv0-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv1-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv10-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv11-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv12-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv13-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv14-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv15-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv2-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv3-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv4-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv5-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv6-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv7-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv8-Src2-SP: read error: Hardware does not support second output source selection
TS-EVR0:RearUniv9-Src2-SP: read error: Hardware does not support second output source selection
iocRun: All initialization complete
# EVR
# make the timestamp available to other equipment (e.g., data acquisition)
dbpf TS-EVR0:Time-I.TSE  -2
DBR_SHORT:          -2        0xfffffffe          
# Which EVNT should we use? I guess the EPICS EventNumber EPICSEVT
dbpf TS-EVR0:Time-I.EVNT 14
DBR_SHORT:          14        0xe                 
dbl > SD-TS-IOC.pvlist
sleep(5)
mrmEvgSoftTimestamp: Could not retrive timestamp...
mrmEvgSoftTimestamp: Could not retrive timestamp...
Starting timestamping
epicsTime: Mon Dec 19 2016 15:55:57.000000000
mrmEvgSoftTimestamp: Could not retrive timestamp...
NTP time:
epicsTime: Mon Dec 19 2016 15:55:58.000036658
EVG time:
epicsTime: Mon Dec 19 2016 15:55:59.000000000
----Timestamping Error of -0.999963 Secs----
TS reset w/ old or invalid seconds 5857f4ff (5857f4f7 00000000)
NTP time:
epicsTime: Mon Dec 19 2016 15:55:59.000040090
EVG time:
epicsTime: Mon Dec 19 2016 15:56:00.000000000
----Timestamping Error of -0.999960 Secs----
# Mandatory if Fake timestamp source for testing without real hardware timestamp source (e.g., GPS recevier)
#
dbpf TS-EVG0:SyncTimestamp-Cmd 1
DBR_STRING:         
epicsEnvSet IOCSH_PS1,"SD-TS-IOC> "
SD-TS-IOC> TS reset w/ old or invalid seconds 5857f501 (5857f501 5857f4ff)

SD-TS-IOC> 


SD-TS-IOC> exit

/opt/epics/modules/environment/1.4.1/3.14.12.5/bin/eldk56-e500v2/iocsh: line 373:  3580 Segmentation fault      /opt/epics/bases/base-3.14.12.5/bin/eldk56-e500v2/softIoc -D /opt/epics/bases/base-3.14.12.5/dbd/softIoc.dbd /tmp/iocsh.startup.3564
root@localhost:~/localdisk/javier# less /opt/epics/modules/environment/1.4.1/3.14.12.5/bi

